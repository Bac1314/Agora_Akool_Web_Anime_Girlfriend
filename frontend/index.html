<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>„Éê„Éº„ÉÅ„É£„É´ÂΩºÂ•≥ - Virtual Girlfriend</title>
    <link rel="stylesheet" href="styles/main.css">
    <script src="/lib/agora-rtc-sdk-ng/AgoraRTC_N-production.js"></script>
    <script src="/lib/agora-rtm/agora-rtm.js"></script>
</head>
<body>
    <div class="app-container">
        <!-- Full-Screen Avatar Background -->
        <div class="avatar-fullscreen" id="avatarContainer">
            <div class="avatar-placeholder" id="avatarPlaceholder">
                <div class="loader"></div>
                <p data-i18n="avatarLoading">Click 'Start Call' to connect</p>
            </div>
            <div class="avatar-video" id="avatarVideo" style="display: none;"></div>
        </div>

        <!-- User Camera Preview (Top Left) -->
        <div class="user-camera-preview" id="userCameraPreview" style="display: none;">
            <div class="camera-video" id="userCameraVideo"></div>
            <div class="camera-label" data-i18n="you">You</div>
        </div>

        <!-- Top Status Bar -->
        <div class="status-overlay">
            <div class="status-left">
                <div class="app-title" data-i18n="title">Virtual Girlfriend</div>
            </div>
            <div class="status-right">
                <div class="status-item" id="connectionStatus">
                    <span class="status-dot offline"></span>
                </div>
                <button class="btn-icon" id="debugBtn" title="Toggle Debug Info">
                    ñ¢•
                </button>
                <button class="btn-icon" id="languageBtn" title="Language">
                    üåê
                </button>
                <button class="btn-icon" id="settingsBtn" title="Settings">
                    ‚öô
                </button>
            </div>
        </div>

        <!-- Control Bar with Chat (Bottom) -->
        <div class="control-bar">
            <!-- Chat Overlay -->
            <div class="chat-overlay" id="chatOverlay">
                <!-- Chat Messages Panel (Collapsible) -->
                <div class="chat-panel" id="chatPanel">
                    <div class="chat-header">
                        <div class="chat-title" data-i18n="chat">„ÉÅ„É£„ÉÉ„Éà</div>
                        <div class="chat-actions">
                            <button class="btn-mini" id="clearChatBtn" data-i18n="clear">„ÇØ„É™„Ç¢</button>
                            <button class="btn-mini" id="closeChatBtn">√ó</button>
                        </div>
                    </div>

                    <div class="chat-messages" id="chatMessages">
                        <div class="message system">
                            <div class="message-content">
                                <p data-i18n="welcomeMessage">Hello! I'm your girlfriend ‚ô™ How are you today?</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Chat Input (Always Visible) -->
                <div class="chat-input-container">
                    <div class="input-group">
                        <button class="chat-toggle" id="chatToggle" title="Show chat history">
                            <span class="chat-icon">üí¨</span>
                        </button>
                        <input
                            type="text"
                            id="messageInput"
                            data-i18n="messagePlaceholder"
                            placeholder="Type your message... ‚ô™"
                            disabled
                        >
                        <button class="btn-send" id="sendBtn" disabled>
                            ‚Üí
                        </button>
                    </div>
                    <div class="typing-indicator" id="typingIndicator" style="display: none;">
                        <span data-i18n="responding">She is thinking of a response...</span>
                        <div class="typing-dots">
                            <span></span>
                            <span></span>
                            <span></span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Control Buttons -->
            <div class="control-buttons">
                <button class="btn-control btn-call" id="callBtn" data-state="start">
                    <div class="control-icon" id="callIcon">
                        <img src="/src/assets/call.svg" alt="Start Call" class="icon-svg" id="callIconImg">
                    </div>
                    <div class="control-text" id="callText" data-i18n="startCall">Start Call</div>
                </button>
                <button class="btn-control btn-mute" id="muteBtn" disabled>
                    <div class="control-icon" id="muteIcon">
                        <img src="/src/assets/microphone.svg" alt="Mute Audio" class="icon-svg">
                        <div class="mute-overlay" id="muteOverlay" style="display: none;"></div>
                    </div>
                </button>
                <button class="btn-control btn-video-mute" id="videoMuteBtn" disabled>
                    <div class="control-icon" id="videoMuteIcon">
                        <img src="/src/assets/webcam.svg" alt="Mute Video" class="icon-svg">
                        <div class="mute-overlay" id="videoMuteOverlay" style="display: none;"></div>
                    </div>
                </button>
            </div>
        </div>

        <!-- Settings Modal -->
        <div class="modal-overlay" id="settingsModal" style="display: none;">
            <div class="modal">
                <div class="modal-header">
<h2 data-i18n="settings">Settings</h2>
                    <button class="btn-close" id="closeSettingsBtn">√ó</button>
                </div>
                <div class="modal-body">
                    <div class="setting-group">
<label for="channelName" data-i18n="roomName">Room Name:</label>
                        <input type="text" id="channelName" value="virtual-girlfriend-room">
                    </div>
                    <div class="setting-group">
<label for="userName" data-i18n="yourName">Your Name:</label>
                        <input type="text" id="userName" value="User" data-i18n="namePlaceholder" placeholder="Enter your name">
                    </div>
                    <div class="setting-group">
                        <label class="checkbox-label">
                            <input type="checkbox" id="enableVoice" checked>
                            <span class="checkmark"></span>
<span data-i18n="enableVoice">Enable Voice Chat</span>
                        </label>
                    </div>
                    <div class="setting-group">
                        <label class="checkbox-label">
                            <input type="checkbox" id="enableAvatar" checked>
                            <span class="checkmark"></span>
<span data-i18n="enableVideo">Enable Video Call</span>
                        </label>
                    </div>
                    <div class="setting-group">
                        <label for="languageSelect" data-i18n="language">Ë®ÄË™û:</label>
                        <select id="languageSelect" class="language-select">
                            <option value="ja">üáØüáµ Êó•Êú¨Ë™û</option>
                            <option value="en">üá∫üá∏ English</option>
                            <option value="ko">üá∞üá∑ ÌïúÍµ≠Ïñ¥</option>
                            <option value="zh">üá®üá≥ ‰∏≠Êñá</option>
                        </select>
                    </div>
                </div>
                <div class="modal-footer">
<button class="btn btn-secondary" id="cancelSettingsBtn" data-i18n="cancel">Cancel</button>
                    <button class="btn btn-primary" id="saveSettingsBtn" data-i18n="save">Save</button>
                </div>
            </div>
        </div>

        <!-- Loading Overlay -->
        <div class="loading-overlay" id="loadingOverlay" style="display: none;">
            <div class="loading-content">
                <div class="loader"></div>
                <p data-i18n="connecting">Connecting to your girlfriend...</p>
            </div>
        </div>
        
        <!-- Language Selector Modal -->
        <div class="modal-overlay" id="languageModal" style="display: none;">
            <div class="modal language-modal">
                <div class="modal-header">
                    <h2 data-i18n="language">Language</h2>
                    <button class="btn-close" id="closeLanguageBtn">√ó</button>
                </div>
                <div class="modal-body">
                    <div class="language-options">
                        <div class="language-option" data-lang="ja">
                            <span class="flag">üáØüáµ</span>
                            <span class="name">Êó•Êú¨Ë™û</span>
                        </div>
                        <div class="language-option" data-lang="en">
                            <span class="flag">üá∫üá∏</span>
                            <span class="name">English</span>
                        </div>
                        <div class="language-option" data-lang="ko">
                            <span class="flag">üá∞üá∑</span>
                            <span class="name">ÌïúÍµ≠Ïñ¥</span>
                        </div>
                        <div class="language-option" data-lang="zh">
                            <span class="flag">üá®üá≥</span>
                            <span class="name">‰∏≠Êñá</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Conversation Summary Modal -->
        <div class="modal-overlay" id="summaryModal" style="display: none;">
            <div class="modal summary-modal">
                <div class="modal-header">
                    <h2 data-i18n="conversationSummary">Conversation Summary</h2>
                    <button class="btn-close" id="closeSummaryBtn">√ó</button>
                </div>
                <div class="modal-body">
                    <div class="summary-loading" id="summaryLoading" style="display: none;">
                        <div class="loader"></div>
                        <p data-i18n="analyzingConversation">Analyzing your conversation...</p>
                    </div>
                    <div class="summary-content" id="summaryContent" style="display: none;">
                        <div class="rating-section">
                            <div class="rating-label" data-i18n="yourRating">Your Conversation Rating</div>
                            <div class="star-rating" id="starRating">
                                <span class="star">‚òÖ</span>
                                <span class="star">‚òÖ</span>
                                <span class="star">‚òÖ</span>
                                <span class="star">‚òÖ</span>
                                <span class="star">‚òÖ</span>
                            </div>
                            <div class="rating-description" id="ratingDescription">
                                Average - Decent conversation, polite but basic interaction
                            </div>
                        </div>
                        <div class="summary-section">
                            <div class="summary-label" data-i18n="summary">Summary</div>
                            <div class="summary-text" id="summaryText">
                                Your conversation summary will appear here...
                            </div>
                        </div>
                    </div>
                    <div class="summary-error" id="summaryError" style="display: none;">
                        <p>Failed to generate summary. Please try again.</p>
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-primary" id="closeSummaryDoneBtn" data-i18n="done">Done</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Debug Info -->
    <div class="debug-info" id="debugInfo" style="display: none;">
        <div class="debug-header">
            <span class="debug-title">Debug Information</span>
            <button class="btn-copy-debug" id="copyDebugBtn" title="Copy all debug info to clipboard">
                <span class="copy-icon">üìã</span>
                <span class="copy-label">Copy All</span>
            </button>
        </div>
        <div class="debug-item">
            <span class="debug-label">Channel:</span>
            <span class="debug-value copyable" id="debugChannel" data-copy-type="channel" title="Click to copy">-</span>
        </div>
        <div class="debug-item">
            <span class="debug-label">User:</span>
            <span class="debug-value copyable" id="debugUser" data-copy-type="user" title="Click to copy">-</span>
        </div>
        <div class="debug-item">
            <span class="debug-label">Agent:</span>
            <span class="debug-value copyable" id="debugAgent" data-copy-type="agent" title="Click to copy">-</span>
        </div>
    </div>

    <script src="utils/i18n.js"></script>
    <script src="utils/config.js"></script>
    <script src="utils/agoraManager.js"></script>
    <script src="utils/avatarManager.js"></script>
    <script src="components/chat.js"></script>
    <script src="components/controls.js"></script>
    <script src="components/language.js"></script>
    <script src="main.js"></script>
</body>
</html>